---
title: "Statisika"
author: "Patrik Landeka"
date: "`r Sys.Date()`"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Učitavanje podataka

```{r}
path <- "./data.csv"

data1 <- read.csv2(path)
data1[data1 == "/"] <- NA
View(data1)

```

## Prepoznavanje okoline i predmeta

Ispisuje koliko puta je objekt prepoznat ako je primljen slikovni ulaz.

```{r}
library(dplyr)

data1 %>%
  filter(vrsta.ulaza != "tekst") %>%    
  group_by(naziv.modela, prepoznat.objekt) %>%
  summarise(broj = n())
```

Ispisuje koliko puta je okolina prepoznata.

```{r}
data1 %>%
  group_by(naziv.modela, prepoznato.okruženje) %>%
  summarise(broj = n())
data1 <- data1 %>% 
  filter(!is.na(prepoznato.okruženje))
```

## Potraga za predmetom kad se on nalazi u slici

Prikazuje koliko puta je model pronašao predmet ako je on stvarno bio u slici ili nije bio za slikovni unos.

```{r}
library(ggplot2)

data1 %>%
  filter(vrsta.ulaza == "slika") %>%
  group_by( naziv.modela, E..predmet.u.slici) %>%
  summarise(broj = n())
data1 %>%
  filter(vrsta.ulaza == "slika") %>%
  group_by( naziv.modela, E..predmet.u.slici, predmet.u.slici) %>%
  summarise(broj = n(), .groups = "drop") %>%
  filter(predmet.u.slici %in% c("DA", "NE"))

data1 %>%
  filter(vrsta.ulaza == "slika") %>%
  filter(predmet.u.slici %in% c("DA", "NE")) %>%
  group_by(naziv.modela, E..predmet.u.slici, predmet.u.slici) %>%
  summarise(broj = n(), .groups = "drop") %>%
  ggplot(aes(x = predmet.u.slici, y = broj, fill = E..predmet.u.slici)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_text(aes(label = broj), position = position_dodge(width = 0.9), vjust = -0.3, size = 3.5) +
  facet_wrap(~naziv.modela) +
  labs(
    title = "Usporedba modela po stvarnom i dobivenom odgovoru za slikovni unos",
    x = "Odgovor modela (DA / NE)",
    y = "Broj ponavljanja",
    fill = "Očekivani odgovor"
  ) +
  theme_minimal()

```

Prikazuje koliko puta je model pronašao predmet ako je on stvarno bio u slici ili nije bio za tekstualni unos.

```{r}
data1 %>%
  filter(vrsta.ulaza == "tekst") %>%
  group_by( naziv.modela, E..predmet.u.slici) %>%
  summarise(broj = n())
data1 %>%
  filter(vrsta.ulaza == "tekst") %>%
  group_by( naziv.modela, E..predmet.u.slici, predmet.u.slici) %>%
  summarise(broj = n(), .groups = "drop") %>%
  filter(predmet.u.slici %in% c("DA", "NE"))
data1 %>%
  filter(vrsta.ulaza == "tekst") %>%
  filter(predmet.u.slici %in% c("DA", "NE")) %>%
  group_by(naziv.modela, E..predmet.u.slici, predmet.u.slici) %>%
  summarise(broj = n(), .groups = "drop") %>%
  ggplot(aes(x = predmet.u.slici, y = broj, fill = E..predmet.u.slici)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_text(aes(label = broj), position = position_dodge(width = 0.9), vjust = -0.3, size = 3.5) +
  facet_wrap(~naziv.modela) +
  labs(
    title = "Usporedba modela po stvarnom i dobivenom odgovoru za tekstualni unos",
    x = "Odgovor modela (DA / NE)",
    y = "Broj ponavljanja",
    fill = "Očekivani odgovor"
  ) +
  theme_minimal()
```

## Potraga za predmetom kad se ne nalazi u slici

### Visoka vjerojatnost

Slikovni unos

```{r}
library(readr)

data1 <- data1 %>%
  mutate(
    ocjena_koordinata = as.numeric(ocjena.koordinata..1.5.),
    ocjena_uputa = as.numeric(ocjena.uputa..1.5.),
    ocjena_vjerojatnosti = as.numeric(ocjena.vjerojatnosti..1.5.),
    vrijeme_izvodenja = as.numeric(vrijeme.izvođenja)
  )

# Filtriraj testove s rbr od 14 do 22
filtered_data <- data1 %>%
  filter(rbr >= 14 & rbr <= 22)

# Izračunaj prosjeke i standardne devijacije za filtrirane podatke
statistika_po_modelu <- filtered_data %>%
  group_by(naziv.modela) %>%
  summarise(
    prosjek_koordinata = round(mean(ocjena_koordinata, na.rm = TRUE), 2),
    sd_koordinata = round(sd(ocjena_koordinata, na.rm = TRUE), 2),
    prosjek_uputa = round(mean(ocjena_uputa, na.rm = TRUE), 2),
    sd_uputa = round(sd(ocjena_uputa, na.rm = TRUE), 2),
    prosjek_vjerojatnosti = round(mean(ocjena_vjerojatnosti, na.rm = TRUE), 2),
    sd_vjerojatnosti = round(sd(ocjena_vjerojatnosti, na.rm = TRUE), 2)
  )

# Prikaz rezultata
print(statistika_po_modelu)
```

Tekstualni unos

```{r}
filtered_data <- data1 %>%
  filter(rbr >= 51 & rbr <= 59)

# Izračunaj prosjeke i standardne devijacije za filtrirane podatke
statistika_po_modelu <- filtered_data %>%
  group_by(naziv.modela) %>%
  summarise(
    prosjek_koordinata = round(mean(ocjena_koordinata, na.rm = TRUE), 2),
    sd_koordinata = round(sd(ocjena_koordinata, na.rm = TRUE), 2),
    prosjek_uputa = round(mean(ocjena_uputa, na.rm = TRUE), 2),
    sd_uputa = round(sd(ocjena_uputa, na.rm = TRUE), 2),
    prosjek_vjerojatnosti = round(mean(ocjena_vjerojatnosti, na.rm = TRUE), 2),
    sd_vjerojatnosti = round(sd(ocjena_vjerojatnosti, na.rm = TRUE), 2)
  )

# Prikaz rezultata
print(statistika_po_modelu)
```

### Srednje visoka vjerojatnost

Slikovni unos

```{r}
filtered_data <- data1 %>%
  filter(rbr >= 23 & rbr <= 32)

# Izračunaj prosjeke i standardne devijacije za filtrirane podatke
statistika_po_modelu <- filtered_data %>%
  group_by(naziv.modela) %>%
  summarise(
    prosjek_koordinata = round(mean(ocjena_koordinata, na.rm = TRUE), 2),
    sd_koordinata = round(sd(ocjena_koordinata, na.rm = TRUE), 2),
    prosjek_uputa = round(mean(ocjena_uputa, na.rm = TRUE), 2),
    sd_uputa = round(sd(ocjena_uputa, na.rm = TRUE), 2),
    prosjek_vjerojatnosti = round(mean(ocjena_vjerojatnosti, na.rm = TRUE), 2),
    sd_vjerojatnosti = round(sd(ocjena_vjerojatnosti, na.rm = TRUE), 2)
  )

# Prikaz rezultata
print(statistika_po_modelu)
```

Tekstualni unos

```{r}
filtered_data <- data1 %>%
  filter(rbr >= 60 & rbr <= 69)

# Izračunaj prosjeke i standardne devijacije za filtrirane podatke
statistika_po_modelu <- filtered_data %>%
  group_by(naziv.modela) %>%
  summarise(
    prosjek_koordinata = round(mean(ocjena_koordinata, na.rm = TRUE), 2),
    sd_koordinata = round(sd(ocjena_koordinata, na.rm = TRUE), 2),
    prosjek_uputa = round(mean(ocjena_uputa, na.rm = TRUE), 2),
    sd_uputa = round(sd(ocjena_uputa, na.rm = TRUE), 2),
    prosjek_vjerojatnosti = round(mean(ocjena_vjerojatnosti, na.rm = TRUE), 2),
    sd_vjerojatnosti = round(sd(ocjena_vjerojatnosti, na.rm = TRUE), 2)
  )

# Prikaz rezultata
print(statistika_po_modelu)
```

Slikovni i tekstualni unos

```{r}
filtered_data <- data1 %>%
  filter( (rbr >= 23 & rbr <= 32) | (rbr >= 60 & rbr <= 69))

# Izračunaj prosjeke i standardne devijacije za filtrirane podatke
statistika_po_modelu <- filtered_data %>%
  group_by(naziv.modela) %>%
  summarise(
    prosjek_koordinata = round(mean(ocjena_koordinata, na.rm = TRUE), 2),
    sd_koordinata = round(sd(ocjena_koordinata, na.rm = TRUE), 2),
    prosjek_uputa = round(mean(ocjena_uputa, na.rm = TRUE), 2),
    sd_uputa = round(sd(ocjena_uputa, na.rm = TRUE), 2),
    prosjek_vjerojatnosti = round(mean(ocjena_vjerojatnosti, na.rm = TRUE), 2),
    sd_vjerojatnosti = round(sd(ocjena_vjerojatnosti, na.rm = TRUE), 2)
  )

# Prikaz rezultata
print(statistika_po_modelu)
```

Vizualno

```{r}
library(tidyr)

# Prvi raspon: rbr 23–32 i 60–69
filtered_data1 <- data1 %>%
  filter((rbr >= 23 & rbr <= 32) | (rbr >= 60 & rbr <= 69)) %>%
  group_by(naziv.modela) %>%
  summarise(
    prosjek_koordinata = mean(ocjena_koordinata, na.rm = TRUE),
    sd_koordinata = sd(ocjena_koordinata, na.rm = TRUE),
    prosjek_uputa = mean(ocjena_uputa, na.rm = TRUE),
    sd_uputa = sd(ocjena_uputa, na.rm = TRUE),
    prosjek_vjerojatnosti = mean(ocjena_vjerojatnosti, na.rm = TRUE),
    sd_vjerojatnosti = sd(ocjena_vjerojatnosti, na.rm = TRUE)
  ) %>%
  pivot_longer(cols = starts_with("prosjek"), names_to = "kategorija", values_to = "vrijednost") %>%
  mutate(sd = case_when(
    kategorija == "prosjek_koordinata" ~ sd_koordinata,
    kategorija == "prosjek_uputa" ~ sd_uputa,
    kategorija == "prosjek_vjerojatnosti" ~ sd_vjerojatnosti
  ),
  raspon = "Srednja vjerojatnost")

# Drugi raspon: rbr 51–59 i 14-22
filtered_data2 <- data1 %>%
  filter((rbr >= 51 & rbr <= 59) | (rbr >= 14 & rbr <= 22)) %>%
  group_by(naziv.modela) %>%
  summarise(
    prosjek_koordinata = mean(ocjena_koordinata, na.rm = TRUE),
    sd_koordinata = sd(ocjena_koordinata, na.rm = TRUE),
    prosjek_uputa = mean(ocjena_uputa, na.rm = TRUE),
    sd_uputa = sd(ocjena_uputa, na.rm = TRUE),
    prosjek_vjerojatnosti = mean(ocjena_vjerojatnosti, na.rm = TRUE),
    sd_vjerojatnosti = sd(ocjena_vjerojatnosti, na.rm = TRUE)
  ) %>%
  pivot_longer(cols = starts_with("prosjek"), names_to = "kategorija", values_to = "vrijednost") %>%
  mutate(sd = case_when(
    kategorija == "prosjek_koordinata" ~ sd_koordinata,
    kategorija == "prosjek_uputa" ~ sd_uputa,
    kategorija == "prosjek_vjerojatnosti" ~ sd_vjerojatnosti
  ),
  raspon = "Visoka vjerojatnost")

# Kombiniraj oba seta podataka
viz_data <- bind_rows(filtered_data1, filtered_data2)

# Vizualizacija
ggplot(viz_data, aes(x = naziv.modela, y = vrijednost, fill = kategorija)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.8)) +
  geom_errorbar(aes(ymin = vrijednost - sd, ymax = vrijednost + sd),
                position = position_dodge(width = 0.8), width = 0.3) +
  geom_text(aes(label = round(vrijednost, 2)),
            position = position_dodge(width = 0.8),
            vjust = -0.3,
            size = 3.5) +
  facet_wrap(~raspon) +
  labs(title = "Prosjeci i SD po modelima za različite skupine primjera",
       x = "Model",
       y = "Vrijednost ocjene",
       fill = "Kategorija") +
  theme_minimal()


```

## Niska vjerojatnost

```{r}
# Filtriranje samo jednog raspona
filtered_data <- data1 %>%
  filter((rbr >= 33 & rbr <= 37) | (rbr >= 70 & rbr <= 74)) %>%
  group_by(naziv.modela) %>%
  summarise(
    prosjek_koordinata = mean(ocjena_koordinata, na.rm = TRUE),
    sd_koordinata = sd(ocjena_koordinata, na.rm = TRUE),
    prosjek_uputa = mean(ocjena_uputa, na.rm = TRUE),
    sd_uputa = sd(ocjena_uputa, na.rm = TRUE),
    prosjek_vjerojatnosti = mean(ocjena_vjerojatnosti, na.rm = TRUE),
    sd_vjerojatnosti = sd(ocjena_vjerojatnosti, na.rm = TRUE)
  ) %>%
  pivot_longer(
    cols = starts_with("prosjek"),
    names_to = "kategorija",
    values_to = "vrijednost"
  ) %>%
  mutate(
    sd = case_when(
      kategorija == "prosjek_koordinata" ~ sd_koordinata,
      kategorija == "prosjek_uputa" ~ sd_uputa,
      kategorija == "prosjek_vjerojatnosti" ~ sd_vjerojatnosti
    ),
    raspon = "Niska vjerojatnost"
  )

# Vizualizacija s jednim rasponom
ggplot(filtered_data, aes(x = naziv.modela, y = vrijednost, fill = kategorija)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.8)) +
  geom_errorbar(
    aes(ymin = vrijednost - sd, ymax = vrijednost + sd),
    position = position_dodge(width = 0.8),
    width = 0.3
  ) +
  geom_text(
    aes(label = round(vrijednost, 2)),
    position = position_dodge(width = 0.8),
    vjust = -0.3,
    size = 3.5
  ) +
  facet_wrap(~raspon) +
  labs(
    title = "Prosjeci i SD po modelima - niska vjerojatnost",
    x = "Model",
    y = "Vrijednost ocjene",
    fill = "Kategorija"
  ) +
  theme_minimal()


```

## Brzina izvođenja

```{r}
# Agregacija podataka bez filtriranja
filtered_data <- data1 %>%
  group_by(naziv.modela) %>%
  summarise(
    prosjek_vremena = mean(vrijeme_izvodenja, na.rm = TRUE),
    sd_vremena = sd(vrijeme_izvodenja, na.rm = TRUE)
  ) %>%
  filter(!is.na(prosjek_vremena), !is.na(sd_vremena)) %>%
  mutate(raspon = "Svi podaci")


# Vizualizacija
ggplot(filtered_data, aes(x = naziv.modela, y = prosjek_vremena, fill = naziv.modela)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.8)) +
  geom_errorbar(
    aes(ymin = prosjek_vremena - sd_vremena, ymax = prosjek_vremena + sd_vremena),
    width = 0.3,
    position = position_dodge(width = 0.8)
  ) +
  geom_text(
    aes(label = round(prosjek_vremena, 2)),
    vjust = -0.3,
    position = position_dodge(width = 0.8),
    size = 3.5
  ) +
  facet_wrap(~raspon) +
  labs(
    title = "Prosječno vrijeme izvođenja po modelima (svi podaci)",
    x = "Model",
    y = "Vrijeme izvođenja (s)",
    fill = "Model"
  ) +
  theme_minimal()

```

## Usporedba slikovnog i tekstualnog upita

```{r}
#Pretvori ocjene u numerički format
data1 <- data1 %>%
  mutate(
    grupa = ifelse(rbr <= 37, "slikovni", "tekstualni")
  )

# Grupiraj po modelu i grupi, izračunaj prosjeke i SD
statistika <- data1 %>%
  group_by(grupa) %>%
  summarise(
    prosjek_koordinata = mean(ocjena_koordinata, na.rm = TRUE),
    sd_koordinata = sd(ocjena_koordinata, na.rm = TRUE),
    prosjek_uputa = mean(ocjena_uputa, na.rm = TRUE),
    sd_uputa = sd(ocjena_uputa, na.rm = TRUE),
    prosjek_vjerojatnosti = mean(ocjena_vjerojatnosti, na.rm = TRUE),
    sd_vjerojatnosti = sd(ocjena_vjerojatnosti, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  pivot_longer(
    cols = starts_with("prosjek"),
    names_to = "kategorija",
    values_to = "vrijednost"
  ) %>%
  mutate(
    sd = case_when(
      kategorija == "prosjek_koordinata" ~ sd_koordinata,
      kategorija == "prosjek_uputa" ~ sd_uputa,
      kategorija == "prosjek_vjerojatnosti" ~ sd_vjerojatnosti
    ),
    kategorija = case_when(
      kategorija == "prosjek_koordinata" ~ "Koordinate",
      kategorija == "prosjek_uputa" ~ "Upute",
      kategorija == "prosjek_vjerojatnosti" ~ "Vjerojatnost"
    )
  )

# Vizualizacija
ggplot(statistika, aes(x = grupa, y = vrijednost, fill = grupa)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.8)) +
  geom_errorbar(
    aes(ymin = vrijednost - sd, ymax = vrijednost + sd),
    position = position_dodge(width = 0.8),
    width = 0.3
  ) +
  geom_text(
    aes(label = round(vrijednost, 2)),
    position = position_dodge(width = 0.8),
    vjust = -0.3,
    size = 3.5
  ) +
  facet_wrap(~kategorija, scales = "free_y") +
  labs(
    title = "Usporedba prosječnih ocjena za slikovni i tekstualni upit",
    x = "Grupa",
    y = "Prosječna ocjena",
    fill = "Grupa"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 0, hjust = 0.5))


```

## Usporedba različitih jezičnih modela

```{r}
# Grupiraj po modelu i izračunaj prosjeke i SD
statistika <- data1 %>%
  group_by(naziv.modela) %>%
  summarise(
    prosjek_koordinata = mean(ocjena_koordinata, na.rm = TRUE),
    sd_koordinata = sd(ocjena_koordinata, na.rm = TRUE),
    prosjek_uputa = mean(ocjena_uputa, na.rm = TRUE),
    sd_uputa = sd(ocjena_uputa, na.rm = TRUE),
    prosjek_vjerojatnosti = mean(ocjena_vjerojatnosti, na.rm = TRUE),
    sd_vjerojatnosti = sd(ocjena_vjerojatnosti, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  pivot_longer(
    cols = starts_with("prosjek"),
    names_to = "kategorija",
    values_to = "vrijednost"
  ) %>%
  mutate(
    sd = case_when(
      kategorija == "prosjek_koordinata" ~ sd_koordinata,
      kategorija == "prosjek_uputa" ~ sd_uputa,
      kategorija == "prosjek_vjerojatnosti" ~ sd_vjerojatnosti
    ),
    kategorija = case_when(
      kategorija == "prosjek_koordinata" ~ "Koordinate",
      kategorija == "prosjek_uputa" ~ "Upute",
      kategorija == "prosjek_vjerojatnosti" ~ "Vjerojatnost"
    )
  )

# Vizualizacija
ggplot(statistika, aes(x = naziv.modela, y = vrijednost, fill = naziv.modela)) +
  geom_bar(stat = "identity", position = position_dodge(width = 0.8)) +
  geom_errorbar(
    aes(ymin = vrijednost - sd, ymax = vrijednost + sd),
    position = position_dodge(width = 0.8),
    width = 0.3
  ) +
  geom_text(
    aes(label = round(vrijednost, 2)),
    position = position_dodge(width = 0.8),
    vjust = -0.3,
    size = 3.5
  ) +
  facet_wrap(~kategorija, scales = "free_y") +
  labs(
    title = "Prosjeci ocjena i SD po modelima (svi podaci)",
    x = "Model",
    y = "Prosječna ocjena",
    fill = "Model"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```
